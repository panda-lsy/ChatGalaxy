# Phase 2 功能测试指南

> **ChatGalaxy 数据管理增强功能** - Web Worker + 批量操作 + 数据编辑器

**版本**: v1.0.0
**日期**: 2026-01-06
**作者**: Claude AI

---

## 📋 测试前准备

### 1. 启动本地服务器

```bash
# 进入项目目录
cd f:\Desktop\ChatGalaxy

# 启动服务器
python -m http.server 8000

# 访问地址
http://localhost:8000
```

### 2. 浏览器要求

- Chrome 90+ ✅ 推荐
- Firefox 88+ ✅
- Safari 14+ ✅
- Edge 90+ ✅

**必需API支持**：
- IndexedDB
- Web Workers
- FileReader
- Intl.Segmenter (中文分词)

---

## 🎯 Phase 2 功能概览

### 阶段1：Web Worker 异步处理 ✅

**新增文件**：
- [js/workers/data-processing-worker.js](../js/workers/data-processing-worker.js) - 增强版数据处理Worker
- 修改 [js/data-import.js](../js/data-import.js) - 集成Worker，自动阈值：>500条消息使用Worker

**核心功能**：
- ✅ 批量处理消息（100条/批）
- ✅ 实时进度反馈
- ✅ 优雅降级：Worker失败 → 同步处理
- ✅ 支持QQChatExporter V5格式

**性能目标**：
- 10,000条消息 < 30秒

---

### 阶段2：批量操作功能 ✅

**新增文件**：
- [js/data/data-batch-operations.js](../js/data/data-batch-operations.js) - 批量操作管理器
- [js/ui/batch-toolbar.js](../js/ui/batch-toolbar.js) - 批量工具栏组件
- [css/batch-toolbar.css](../css/batch-toolbar.css) - 工具栏样式

**核心功能**：
- ✅ 选择管理（全选、多选、取消）
- ✅ 批量删除（二次确认）
- ✅ 批量更新情感值
- ✅ 批量导出（JSON/CSV）

**测试页面**：
- [test-data/test-batch-operations.html](test-batch-operations.html)

---

### 阶段3：数据编辑器 ✅

**新增文件**：
- [js/ui/message-table.js](../js/ui/message-table.js) - 消息表格组件
- [js/ui/editor-modal.js](../js/ui/editor-modal.js) - 编辑器模态框
- [css/data-editor.css](../css/data-editor.css) - 编辑器样式

**核心功能**：
- ✅ 消息列表展示（表格形式）
- ✅ 情感筛选
- ✅ 关键词搜索
- ✅ 列排序
- ✅ 单条消息编辑
- ✅ 单条消息删除
- ✅ 关键词重新提取

**测试页面**：
- [test-data/test-data-editor.html](test-data-editor.html)

---

## 🧪 测试步骤

### 测试1：Web Worker 性能测试

**目的**：验证Worker能够处理大规模数据而不阻塞UI

**步骤**：
1. 准备一个包含1,000条消息的JSON文件
2. 在数据管理器页面导入该文件
3. 观察进度条是否流畅更新
4. 记录导入耗时

**预期结果**：
- ✅ 进度条实时更新
- ✅ UI不卡顿
- ✅ 导入时间 < 5秒（1,000条消息）

**测试数据**：
```json
{
  "messages": [
    {
      "id": "msg_1",
      "senderName": "张三",
      "senderId": "zhangsan",
      "text": "你好！",
      "timestamp": 1704508800
    },
    // ... 重复999条
  ]
}
```

---

### 测试2：批量操作功能测试

**目的**：验证批量操作管理器和工具栏

**步骤**：
1. 访问 `http://localhost:8000/test-data/test-batch-operations.html`
2. 点击"加载测试数据"按钮
3. 测试以下功能：

**2.1 选择管理**：
- [ ] 点击消息项，验证单选
- [ ] 点击"全选"按钮，验证全选
- [ ] 再次点击"全选"按钮，验证取消全选
- [ ] 观察选中数量实时更新

**2.2 批量删除**：
- [ ] 选择多条消息
- [ ] 点击"删除"按钮
- [ ] 验证二次确认对话框
- [ ] 确认后观察消息被删除
- [ ] 验证统计数据更新

**2.3 批量更新情感值**：
- [ ] 选择多条消息
- [ ] 点击"更新情感"下拉菜单
- [ ] 选择"积极"
- [ ] 验证选中消息的情感值已更新

**2.4 批量导出JSON**：
- [ ] 选择多条消息
- [ ] 点击"导出"下拉菜单
- [ ] 选择"导出为 JSON"
- [ ] 验证JSON文件下载成功
- [ ] 检查JSON文件内容正确

**2.5 批量导出CSV**：
- [ ] 选择多条消息
- [ ] 点击"导出"下拉菜单
- [ ] 选择"导出为 CSV"
- [ ] 验证CSV文件下载成功
- [ ] 使用Excel打开CSV，验证格式正确

**预期结果**：
- ✅ 所有操作执行成功
- ✅ UI状态正确更新
- ✅ 导出文件格式正确

---

### 测试3：数据编辑器功能测试

**目的**：验证消息表格和编辑器模态框

**步骤**：
1. 访问 `http://localhost:8000/test-data/test-data-editor.html`
2. 点击"加载测试数据"按钮（100条消息）
3. 测试以下功能：

**3.1 消息列表展示**：
- [ ] 验证表格显示100条消息
- [ ] 检查发送者、时间、内容、情感、关键词列显示正确
- [ ] 验证情感标签颜色正确（红/灰/绿/黄）

**3.2 情感筛选**：
- [ ] 选择"😞 消极"
- [ ] 验证只显示消极消息
- [ ] 选择"😊 积极"
- [ ] 验证只显示积极消息
- [ ] 选择"全部情感"
- [ ] 验证显示所有消息

**3.3 关键词搜索**：
- [ ] 在搜索框输入"天气"
- [ ] 验证只显示包含"天气"的消息
- [ ] 清空搜索框
- [ ] 验证显示所有消息

**3.4 列排序**：
- [ ] 点击"时间"列头
- [ ] 验证消息按时间升序排列
- [ ] 再次点击"时间"列头
- [ ] 验证消息按时间降序排列
- [ ] 点击"发送者"列头
- [ ] 验证消息按发送者名称排序

**3.5 消息选择**：
- [ ] 点击某一行
- [ ] 验证该行被选中（高亮）
- [ ] 点击复选框
- [ ] 验证选中状态
- [ ] 点击全选复选框
- [ ] 验证所有消息被选中

**3.6 编辑消息**：
- [ ] 点击某条消息的"编辑"按钮
- [ ] 验证编辑器模态框打开
- [ ] 修改发送者名称
- [ ] 修改消息内容
- [ ] 修改情感值
- [ ] 点击"重新提取"按钮
- [ ] 验证关键词已更新
- [ ] 点击"保存更改"
- [ ] 验证模态框关闭
- [ ] 验证表格中的消息已更新

**3.7 删除消息**：
- [ ] 点击某条消息的"删除"按钮
- [ ] 验证确认对话框
- [ ] 确认删除
- [ ] 验证消息已从表格中移除

**3.8 批量操作集成**：
- [ ] 选择多条消息
- [ ] 使用批量工具栏的"删除"按钮
- [ ] 验证批量删除成功
- [ ] 使用批量工具栏的"导出"按钮
- [ ] 验证批量导出成功

**预期结果**：
- ✅ 所有功能正常工作
- ✅ UI响应流畅
- ✅ 数据正确保存到IndexedDB

---

## 🔍 浏览器开发者工具验证

### 检查 IndexedDB

1. 打开开发者工具 (F12)
2. 进入 **Application / 应用** 标签
3. 左侧找到 **IndexedDB**
4. 展开 `ChatGalaxyDB`
5. 检查对象存储：

**datasets**:
```javascript
{
  id: "test_editor_dataset_xxx",
  name: "数据编辑器测试数据集",
  messageCount: 100,
  participantCount: 8,
  // ...
}
```

**messages**:
```javascript
{
  id: "msg_0",
  datasetId: "test_editor_dataset_xxx",
  senderName: "张三",
  text: "你好！今天天气真好",
  sentiment: 2,
  keywords: ["你好", "天气", "真好"],
  // ...
}
```

### 检查控制台日志

**预期日志**：
```
📊 DatasetManager v3.0 initialized
📥 DataImport v3.0 initialized
✅ Chinese word segmentation: Intl.Segmenter
📝 TextProcessor v1.0 initialized
🔧 DataBatchOperations v1.0 loaded
✅ BatchToolbar v1.0 loaded
📋 MessageTable v1.0 loaded
✏️ EditorModal v1.0 loaded
```

### 检查网络请求

**无网络请求** ✅
所有数据存储在本地IndexedDB，无需服务器交互

---

## 🐛 常见问题排查

### 问题1：Worker创建失败

**症状**：
- 控制台错误：`Failed to create worker`
- 数据导入使用同步模式

**解决方案**：
1. 检查Worker文件路径：`js/workers/import-worker.js`
2. 确认文件存在且可访问
3. 检查浏览器是否支持Web Workers

### 问题2：IndexedDB数据丢失

**症状**：
- 刷新页面后数据消失
- 数据集列表为空

**解决方案**：
1. 检查浏览器隐私模式（隐私模式可能禁用IndexedDB）
2. 清除浏览器缓存
3. 检查存储配额（Chrome: DevTools → Application → Storage）

### 问题3：编辑器无法打开

**症状**：
- 点击"编辑"按钮无反应
- 控制台报错

**解决方案**：
1. 检查 `editor-modal` 自定义元素是否注册
2. 确认 `editor-modal.js` 已加载
3. 检查事件监听器是否正确附加

### 问题4：关键词提取失败

**症状**：
- 关键词为空
- 重新提取按钮无效

**解决方案**：
1. 检查 `TextProcessor` 模块是否加载
2. 确认 `Intl.Segmenter` API可用
3. 查看控制台是否有分词错误

---

## ✅ 测试完成清单

### Web Worker (阶段1)
- [ ] Worker文件存在且可访问
- [ ] 数据导入使用Worker处理（>500条）
- [ ] 进度条实时更新
- [ ] UI不卡顿
- [ ] Worker失败时降级到同步处理

### 批量操作 (阶段2)
- [ ] 批量操作管理器正常工作
- [ ] 工具栏组件正确显示
- [ ] 全选/取消全选功能正常
- [ ] 批量删除成功（带确认）
- [ ] 批量更新情感值成功
- [ ] 批量导出JSON成功
- [ ] 批量导出CSV成功

### 数据编辑器 (阶段3)
- [ ] 消息表格正确显示
- [ ] 情感筛选功能正常
- [ ] 关键词搜索功能正常
- [ ] 列排序功能正常
- [ ] 消息选择功能正常
- [ ] 编辑器模态框正常打开
- [ ] 消息编辑保存成功
- [ ] 关键词重新提取成功
- [ ] 单条删除功能正常
- [ ] 批量操作集成正常

---

## 📊 性能基准

### 数据导入性能

| 消息数量 | 预期时间 | Worker使用 |
|---------|---------|-----------|
| 100条   | < 1秒   | ❌ 同步   |
| 500条   | < 3秒   | ❌ 同步   |
| 1,000条 | < 5秒   | ✅ 异步   |
| 10,000条| < 30秒  | ✅ 异步   |

### UI响应性能

| 操作           | 预期时间 | 备注           |
|--------------|---------|---------------|
| 打开编辑器     | < 100ms | 模态框动画     |
| 保存消息       | < 500ms | IndexedDB写入 |
| 批量删除(100条)| < 2秒   | 分批删除       |
| 表格渲染(100条)| < 200ms | DOM操作       |

---

## 🚀 下一步

### 短期优化（1周内）

- [ ] 添加虚拟滚动（支持10,000+条消息）
- [ ] 实现分页功能
- [ ] 添加撤销/重做功能
- [ ] 优化移动端适配

### 中期规划（2-4周）

- [ ] 集成到主数据管理器页面
- [ ] 添加数据验证规则
- [ ] 实现批量编辑功能
- [ ] 添加数据导入模板

### 长期愿景（1-3个月）

- [ ] 接入边缘函数（精确模式）
- [ ] 实现数据集分享功能
- [ ] 添加数据集版本管理
- [ ] 支持多人协作编辑

---

## 📝 测试报告模板

```markdown
## 测试环境
- 浏览器: Chrome XX.X.XXXX
- 操作系统: Windows 10/11
- 测试时间: 2026-01-06
- 测试人员: [您的名字]

## 测试结果
| 测试项 | 状态 | 备注 |
|--------|------|------|
| Worker性能 | ✅/❌ | |
| 批量删除 | ✅/❌ | |
| 批量更新 | ✅/❌ | |
| 批量导出 | ✅/❌ | |
| 消息表格 | ✅/❌ | |
| 编辑器 | ✅/❌ | |

## 发现的问题
1. [问题描述]
   - 重现步骤:
   - 错误信息:
   - 截图:

## 建议和反馈
[您的建议]
```

---

**祝测试顺利！** 🎉

**问题反馈**: [GitHub Issues](https://github.com/panda-lsy/chatgalaxy/issues)
