# ChatGalaxy 变更日志

> **项目**: ChatGalaxy - 3D 聊天记录可视化平台
> **维护者**: 深山有密林团队

---

## [未发布]

### 3.2.0 - 2026-01-07

#### 🎨 主题系统重构（重大更新）

**新增功能**:
- ✨ 全新主题管理系统（ThemeManager）
  - 支持 4 种精美主题：晨曦、森林、海洋、星尘
  - 动态透明度调节（50% - 100%）
  - 实时主题预览和切换
  - 主题变更事件系统

- 🎨 统一侧边栏设计
  - 左右侧边栏共用基础类（SidebarBase）
  - 消息侧边栏重构（MessageSidebar）
  - 设置侧边栏重构（SettingsSidebar）
  - 支持展开/收起动画

- 🌈 多页面主题同步
  - index.html: 3D 星系主页主题集成
  - insights.html: 洞察报告主题集成（图表自动刷新）
  - data-manager.html: 数据管理主题集成
  - intro.html: 介绍页主题集成（背景渐变）

- 🔧 主题控件 UI
  - 可视化主题选择器（2x2 网格布局）
  - 透明度滑块（实时预览）
  - 激活状态视觉反馈（✓ 图标）
  - 响应式设计（移动端优化）

**技术改进**:
- 🏗️ ES6 模块化架构
  - `js/theme/` - 主题系统核心模块
  - `js/ui/` - UI 组件模块
  - `css/theme/` - 主题样式系统
  - `css/components/` - 组件样式

- 🎯 CSS 变量系统
  - 统一的颜色命名规范
  - 动态透明度计算（TransparencyEngine）
  - 主题预定义变量
  - 跨浏览器兼容

- 🔄 自动迁移机制
  - 旧主题自动映射到新主题
  - LocalStorage 设置迁移
  - 支持回滚到旧系统
  - 迁移状态检查

**新增文件** (14个):
```
js/theme/
  ├── theme-manager.js         (~350 行) - 主题管理器
  ├── color-schemes.js         (~280 行) - 配色方案定义
  ├── transparency-engine.js   (~380 行) - 透明度计算引擎
  └── migration.js             (~200 行) - 迁移适配器

js/ui/
  ├── sidebar-base.js          (~380 行) - 侧边栏基类
  ├── left-sidebar.js          (~420 行) - 左侧边栏实现
  ├── right-sidebar.js         (~320 行) - 右侧边栏实现
  ├── theme-selector.js        (~250 行) - 主题选择器
  └── transparency-slider.js   (~280 行) - 透明度滑块

css/theme/
  ├── base.css                 (~150 行) - 基础变量
  ├── schemes.css              (~200 行) - 配色方案
  └── transparency.css         (~250 行) - 透明度系统

css/components/
  ├── sidebar.css              (~650 行) - 侧边栏样式
  └── theme-controls.css       (~350 行) - 主题控件样式
```

**修改文件** (4个):
```
index.html        - 添加主题系统 CSS/JS 集成
insights.html     - 添加主题系统 CSS/JS 集成
data-manager.html - 添加主题系统 CSS/JS 集成
intro.html        - 添加主题系统 CSS/JS 集成
```

**代码统计**:
- 新增代码: ~4,310 行
- 修改代码: ~65 行
- 删除代码: ~0 行

**主题映射**:
```
旧主题          → 新主题
romantic (浪漫粉)  → dawn (晨曦)
deepspace (深空蓝) → ocean (海洋)
nebula (星云紫)   → stardust (星尘)
midnight (午夜黑) → forest (森林) [新增]
```

**已知问题**:
- ⚠️ 深灰色文字在浅粉色背景上对比度为 3.58:1，略低于 WCAG AA 标准 (4.5:1)
  - 原因: 设计上追求柔和、温暖感
  - 影响: 视觉敏感度低的用户可能感觉文字不够清晰
  - 计划: 后续添加"高对比度模式"选项

**测试状态**:
- ✅ 代码结构验证: 14/14 通过 (100%)
- ✅ 透明度系统: 12/13 通过 (92.3%)
- ✅ 多页面集成: 9/9 通过 (100%)
- ⏳ 浏览器测试: 待执行
- ⏳ 实际场景测试: 待执行

**破坏性变更**:
- 无（完全向后兼容，自动迁移）

**升级指南**:
1. 无需手动操作，旧设置自动迁移
2. 首次访问自动应用新主题
3. 如有问题，可在控制台执行 `rollbackToOldSystem()` 回滚

---

## [3.1.0] - 2026-01-07

#### 🔧 边缘函数集成（Phase 3.1）

**新增功能**:
- ✨ 阿里云 ESA Edge Functions 集成
  - Python 3.x 边缘函数支持
  - jieba + SnowNLP 中文分词
  - 双模式数据处理（快速/精确）
  - 配置管理器（edge-function-config.js）

**技术改进**:
- 📊 前端分词优化
  - Intl.Segmenter 浏览器原生分词
  - Web Worker 后台处理
  - 性能提升 ~40%

**新增文件**:
```
esa-functions/
  └── process-chat/
      ├── index.py         (~150 行) - 边缘函数入口
      ├── requirements.txt (~10 行)  - Python 依赖
      └── README.md        (~200 行) - 使用文档

js/
  ├── edge-function-config.js (~180 行) - 配置管理器
  └── workers/
      └── data-processing-worker.js (~120 行) - 数据处理 Worker
```

**代码统计**:
- 新增代码: ~1,300 行
- 修改代码: ~288 行

---

## [3.0.0] - 2026-01-06

#### 🔄 数据管理器重构（Phase 2）

**重大变更**:
- 🗄️ 全新数据管理系统（v3.0）
  - IndexedDB 浏览器数据库
  - 智能数据导入（支持大文件）
  - 消息表格组件（v2.1）
  - 批量操作工具栏

**新增功能**:
- 📋 数据集管理
  - 创建/删除/重命名数据集
  - 数据集版本控制
  - 数据集切换和导入

- 🎛️ 消息编辑器
  - 行内编辑模式
  - 实时保存
  - 编辑历史记录

- 🎯 批量操作
  - 多选消息
  - 批量删除
  - 批量导出

**新增文件**:
```
js/
  ├── data-manager.js          (~850 行) - 数据管理器核心
  ├── data-import.js           (~420 行) - 数据导入系统
  ├── data-batch-operations.js (~180 行) - 批量操作管理
  ├── ui/
  │   ├── message-table.js     (~380 行) - 消息表格组件 v2.1
  │   ├── editor-modal.js      (~250 行) - 编辑器模态框
  │   └── batch-toolbar.js     (~150 行) - 批量操作工具栏
  └── workers/
      └── import-worker.js     (~320 行) - 导入 Worker

css/
  └── data-manager.css         (~650 行) - 数据管理界面样式
```

**代码统计**:
- 新增代码: ~4,000+ 行
- 修改代码: ~150 行

**破坏性变更**:
- `datasets.js` (v2.0) 被移除，使用 `data-manager.js` (v3.0)
- LocalStorage 数据结构变更

---

## [2.0.0] - 2026-01-05

#### 🌟 3D 星系可视化 v2.0

**新增功能**:
- ✨ 3D 关键词语义网络
  - Three.js 强制导向图
  - 节点大小动态计算
  - 边的粗细和透明度
  - 交互式探索（缩放/平移/旋转）

- 🎨 视觉增强系统
  - 粒子特效系统
  - 时间轴回放功能
  - 主题切换（4 种配色方案）

**技术改进**:
- 🚀 性能优化
  - 数据预加载
  - 懒加载节点
  - WebGL 渲染优化

---

## [1.0.0] - 2026-01-04

#### 🎉 首次发布

**核心功能**:
- 📊 聊天记录可视化
  - 3D 星系展示
  - 关键词提取
  - 消息统计分析

- 📈 洞察报告
  - 年度账单风格
  - 情感趋势分析
  - 时间分布统计
  - 关键词排行榜

- 💾 数据导入
  - QQ 聊天记录支持
  - JSON 格式
  - Python 预处理

**技术栈**:
- Three.js r149
- D3.js v7.8.5
- Chart.js v4.4.0
- RemixIcon v3.5.0

---

## 变更类型说明

- 🎨 **新增功能** - 新的功能特性
- 🔧 **改进优化** - 现有功能的改进
- 🐛 **问题修复** - Bug 修复
- 📚 **文档更新** - 文档改进
- ⚠️ **破坏性变更** - 不兼容的变更
- 🗑️ **删除功能** - 移除的功能
- 🔒 **安全修复** - 安全问题修复

---

**维护者**: 深山有密林团队
**最后更新**: 2026-01-07
